# Проблемы и риски
1. Отсутствие согласованности данных - две локальные копии в разных БД с разным интервалом обновления. Расхождение в данных может привести к ошибкам во взаиморасчетах. Прямой риск финансового и репутационного ущерба.
2. Создание узкого горлышка - ошибка проектирования. Запрашивать данных у всех внешних систем единоразово - большой риск - ошибка/недоступность от любого из них приведет к общим проблемам.
3. Также по п.2 - страховые могут хотеть от нас разной частоты обновления информации о продуктах. Кто-то даст ограничение не чаще 1 раза в 15 минут. Кто-то потребует обновлять не реже, чем раз в 5 минут. Риск потери страховой или переноса подключения.
4. Выдача клиентам неактуальных предложений или их цен. Финансовые и репутационные риски.


# Решение
1. Нужно централизовать хранение данных по продуктам и тарифам в БД сервиса ins-product-aggregator.
2. Нужно разделить процесс получения продуктов/тарифов по страховым и устанавливать для каждого интервал запросов.
3. API сервиса ins-product-aggregator должно уметь отдавать из БД все продукты/тарифы, по страховой и по идентификатору.
4. К сервису ins-product-aggregator подключить кеш на API массовой выдачи (все или по страховой) продуктов/тарифов, инвалидировать по изменению.
5. На передачу данных по взаиморасчетам (и получение продуктов/тарифов) применить retry-policy и уведомлять (почта/telegram-bot/мониторинги) об ошибках. Взаиморасчет можно будет произвести ручной выгрузкой (в случае с временной необходимостью) и обменом по почте (в шифрованном виде) или через защищенное файловое хранилище с облачным доступом.


# Доп
Event-Streaming здесь не нужен. В задании видимо имели в виду Event-Driven.
Но поднимать kafka ради обработки событий "обновление тарифов/продуктов", "взаиморасчеты произведены", "заказ оформлен" - это из пушки по воробьям.
В случае, если появится требование о мгновенной передаче информации страховым по оформленным заказам - можно применить transactional outbox для прихранивания заказов и передачи их в kafka с дальнейшим потреблением сервисом ins-comp-settlement для оперативного расчета и передачи страховой.
